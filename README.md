
# clj-sql #

This package was written by developers who use [clojure.contrib.sql](http://richhickey.github.com/clojure-contrib/sql-api.html) but needed to add a few features to support their projects. Most of the functionality and API is inherited from [clojure.contrib.sql](http://richhickey.github.com/clojure-contrib/sql-api.html) but the following additions have been made:

- Table and field names can include dashes e.g. `:customer-invoice`.
- Two functions have been added to do inserts returning autogenerated ids.

## Example ##

    (def *db* { ... })   ;; Uses same datasource as clojure.contrib.sql

    (with-connection *db*
      (create-table
       :an-example
       [:id :integer "PRIMARY KEY" "AUTO_INCREMENT"]
       [:a-long-fieldname "varchar(255)"])
      (create-table
       :another-example
       [:id :integer "PRIMARY KEY" "AUTO_INCREMENT"]
       [:first-example :integer]
       [:another-long-fieldname "varchar(255)"]
       ["FOREIGN KEY" [:first-example] "references" :an-example [:id]))
       
    (with-connection *db*
      (insert-with-id
        :an-example      {:a-long-fieldname "Example text"}
        :another-example {:first-example          (id :an-example)
                          :another-long-fieldname "More example text"}))

## Functions not in clojure.contrib.sql ##

### insert-with-id  ###

Insert records within a single transaction into the current datasource. 
The record format is :table  { record-hash }. 
The record hashes can optionally access a hashmap 'id' which holds the
autogenerated ids of previous inserts keyed by the table name. e.g.
    
      (insert-with-id 
          :department {:name "xfiles"
                       :location "secret"}
          :employee   {:department (id :department)
                       :name "Mr X"})

### insert-record  ###
       
Equivalent of [clojure.contrib.sql/insert-records](http://richhickey.github.com/clojure-contrib/sql-api.html#clojure.contrib.sql/insert-records) that only inserts a single
record but returns the autogenerated id of that record if available.
